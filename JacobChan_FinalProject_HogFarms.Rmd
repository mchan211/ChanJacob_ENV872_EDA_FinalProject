---
output: 
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
geometry: margin=2.54cm
title: "Insert title of project here"
subtitle: "Web address for GitHub repository"
author: "Name"
fontsize: 12pt
mainfont: Times New Roman

---

\newpage
#Table of Contents
* List of Tables
* List of Figures 
* Rationale and Research Question
* Dataset Information
* Exploratory Analysis 
  + Data Table
  + Spatial Analysis
  + Visualization Analysis
* Analysis
* Summary and Conclusions
* Resources

\newpage
#List of Tables
* NC County Health Distribution


\newpage
#List of Figures
* [MAP NAME]
* Population Distribution by County (%)
* Chronic Health Incidence Rates
* Health Accessibility 
* Health Risk Indicators

\newpage

# Rationale and Research Questions
> Our main research question was if NC counties with higher concentration of hog farms would have higher health disparities compared to counties with lower hog farm concentrations. To research this, we looked at health and population distribution data for each NC county and specifically looked at data for counties with the highest concentrations of hog farms (Bladen, Duplin, Greene, Sampson, Robeson, Wayne) and comparing them to Durham as we are current residents of this county. We wanted to gain a better understanding of the inequities and environmental justice issues that stem from NC hog farms and pork production economy. 

\newpage

# Dataset Information
> Our dataset is...........

\newpage

```{r setup, include=FALSE, message = FALSE, warning = FALSE}
# Set your working directory
getwd()

# Load your packages
#install.packages("tidyverse")
library(tidyverse)
#install.packages("magrittr")
library(magrittr)
#install.packages("dplyr")
library(dplyr)
#install.packages("sf")
library(sf)

# Set your ggplot theme
mytheme <- theme_classic(base_size = 12) +
  theme(axis.text = element_text(color = "black"), 
        legend.position = "bottom",
        panel.grid = element_blank(),
        axis.title = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_blank(),
        line = element_blank())
theme_set(mytheme)

# Load your datasets
Health_Data_Raw <- read.csv("../ChanJacob_ENV872_EDA_FinalProject/Data/Raw/County Health Data 2021.csv", stringsAsFactors = TRUE)

```

# Exploratory Analysis 

##Data Table - NC County Health Distribution

```{r, data wrangling, include = FALSE, message = FALSE, error = FALSE}
##Wrangling the dataset 

#Removing columns and rows containing weblinks and other metadata 
Health_Data_Clean <- Health_Data_Raw[-c(1,2,3),-c(1,3, 4, 5, 6)] 

#Using a pipe to select and rename columns
Health_Data_Clean <- Health_Data_Clean %>%
  select(Bold.Indicator.Name.Text, NC, X.6, X.8, X.30,X.31, X.39, X.57, X.81, X.77, X.92, X.95, X.97) %>%
  rename(Indicators = Bold.Indicator.Name.Text, Bladen = X.8, Duplin = X.30, Durham = X.31, Greene = X.39, Sampson = X.81, Robeson = X.77, Wayne = X.95, Wilson = X.97, Warren = X.92, Martin = X.57, Beaufort = X.6)
#Durham - 

#Transposing the data
Health_data_transposed <- t(Health_Data_Clean)

#Converting the transposed data to a dataframe
Health_data_transposed <- as.data.frame(Health_data_transposed)

#Adding a pipe statement to rename the columns
Health_data_transposed_clean <- Health_data_transposed %>%
  rename(Population = 1, Child_Population_percentage = 2, Elderly_Population_percentage = 3, White_Population_percentage = 4, Hispanic_Latinx_percentage = 5, African_American_percentage = 6, American_Indian_percentage = 9, Reading_Proficiency_percentage = 12, Uninsured_Adults_percentage = 14, Medicaid_CHIP_enrolles_percentage = 16, Primary_Care_Physicians = 17, Low_Birthweight_percentage = 32, Infant_Mortality_Rate = 33, Poverty_percentage = 41, Cancer_Incidence = 39, Heart_Disease = 40, Air_Pollution = 52) 

#Selecting the required rows 
Health_data_transposed_clean_1 <- Health_data_transposed_clean[-c(1), -c(7,8, 10, 11, 13, 15, 18:31, 34:38, 42:51, 53:59)]

#Removing '%' character from the dataframe using the 'gsub' function
Health_data_transposed_clean_1 <- Health_data_transposed_clean_1 %>%
  mutate(Population = as.numeric(gsub(",","",Population)),
         Child_Population_percentage = as.numeric(gsub("%", "", Child_Population_percentage)),
         Elderly_Population_percentage = as.numeric(gsub("%", "", Elderly_Population_percentage)),
         White_Population_percentage = as.numeric(gsub("%", "", White_Population_percentage)),
         Hispanic_Latinx_percentage = as.numeric(gsub("%", "", Hispanic_Latinx_percentage)),
         African_American_percentage = as.numeric(gsub("%", "", African_American_percentage)),
         American_Indian_percentage = as.numeric(gsub("%", "", American_Indian_percentage)),
         Reading_Proficiency_percentage = as.numeric(gsub("%", "", Reading_Proficiency_percentage)),
         Uninsured_Adults_percentage = as.numeric(gsub("%", "", Uninsured_Adults_percentage)),
         Medicaid_CHIP_enrolles_percentage = as.numeric(gsub("%", "", Medicaid_CHIP_enrolles_percentage)),
         Low_Birthweight_percentage = as.numeric(gsub("%", "", Low_Birthweight_percentage)),
         Poverty_percentage = as.numeric(gsub("%", "", Poverty_percentage)))



#Checking the class of Health_data_transposed_clean_1
class(Health_data_transposed_clean_1)

#saving wrangled health data in Processed Data folder
write.csv(Health_data_transposed_clean_1, file = "./Data/Processed/CountyHogs_HealthData.csv")
```

```{r health data frame, echo = FALSE, message = FALSE, error = FALSE}
nccounties.health <- read.csv("./Data/Processed/CountyHogs_HealthData.csv", stringsAsFactors = FALSE)

print(nccounties.health)
colnames(nccounties.health)
summary(nccounties.health)
```

\newpage

##Spatial Analysis

```{r}
mapviewOptions(fgb = FALSE)

#Loading in the shapefile and filtering for NC counties
NorthCarolina_sf <- st_read('../ChanJacob_ENV872_EDA_FinalProject/Data/Spatial/cb_2018_us_county_20m.shp') %>%
  filter(STATEFP == 37)

#Filtering counties that have a high population of Hog farms
HighPop_HogFarms_sf <- NorthCarolina_sf %>%
  filter(NAME %in% c("Robeson", "Sampson", "Duplin", "Bladen", "Greene", "Wayne"))

#Filtering counties that have no or low populations of Hog farms
LowPop_HogFarms_sf <- NorthCarolina_sf %>%
  filter(NAME %in% c("Wilson", "Martin", "Beaufort", "Durham", "Warren"))


#Loading in the Hog Farm NC locations file 

HogFarm_Locations <- read.csv("../ChanJacob_ENV872_EDA_FinalProject/Data/Spatial/Hog_Farm_Locations_NC1.csv") 

#Selecting the required columns with Lat/Long
HogFarm_Locations <- HogFarm_Locations %>%
  select(title, latitude, longitude) %>%
   na.omit(HogFarm_Locations)
  
#Converting the dataframe to a sf (spatial features) dataframe
HogFarm_Locations_sf <- HogFarm_Locations %>%
  st_as_sf(coords = c('longitude', 'latitude'),
           crs = 4269)

colnames(HogFarm_Locations_sf)

#Spatial Analysis of Hog Farms in all of NC

HogFarm_Locations_plot <-
ggplot() +
  geom_sf(data = NorthCarolina_sf, aes(fill = 'white')) +
  geom_sf(data = HighPop_HogFarms_sf, aes(fill = 'lightpink')) + 
  geom_sf(data = LowPop_HogFarms_sf, aes(fill = 'powderblue')) +
  geom_sf(data = HogFarm_Locations_sf, aes(color = 'blue'), size = 2, shape = 8) +
  scale_fill_identity(name = "", breaks = c("white", "lightpink", "powderblue"), 
                       labels = c("North Carolina", "Counties with high populations of Hog Farms", "Counties with zero or low populations of Hog Farms"), guide = "legend") +
  scale_color_identity(name = "", breaks = c('blue'), 
                       labels = c('Hog Farms'), guide = 'legend') +
  ggtitle("Hog Farms in North Carolina") +
  mytheme 
print(HogFarm_Locations_plot)


#Spatial Analysis of Counties with a High Population of Hog Farms 

HighPop_HogFarms_sf <- NorthCarolina_sf %>%
  filter(NAME %in% c("Robeson", "Sampson", "Duplin", "Bladen", "Greene", "Wayne"))


Robeson_sf <- NorthCarolina_sf %>%
  filter(NAME %in% c("Robeson"))


Sampson_sf <- NorthCarolina_sf %>%
  filter(NAME %in% c("Sampson"))

Duplin_sf <- NorthCarolina_sf %>%
  filter(NAME %in% c("Duplin"))


Bladen_sf <- NorthCarolina_sf %>%
  filter(NAME %in% c("Bladen"))

Greene_sf <- NorthCarolina_sf %>%
  filter(NAME %in% c("Greene"))


Wayne_sf <- NorthCarolina_sf %>%
  filter(NAME %in% c("Wayne"))

#Finding out the no. of hog farms in each county
Inter_Rob <- HogFarm_Locations_sf[Robeson_sf,]
Inter_Sam <- HogFarm_Locations_sf[Sampson_sf,]
Inter_Dup <- HogFarm_Locations_sf[Duplin_sf,]
Inter_Blad <- HogFarm_Locations_sf[Bladen_sf,]
Inter_Greene <- HogFarm_Locations_sf[Greene_sf,]


Intersection <- HogFarm_Locations_sf[HighPop_HogFarms_sf,] 
 
HighPop <-
ggplot() +
  geom_sf(data = Robeson_sf, aes(fill = 'lavender')) + 
  geom_sf(data = Sampson_sf, aes(fill = 'lightblue1')) +
  geom_sf(data = Duplin_sf, aes(fill = 'palegreen')) +
  geom_sf(data = Bladen_sf, aes(fill = 'thistle1')) +
  geom_sf(data = Greene_sf, aes(fill = 'lightyellow1')) +
  geom_sf(data = Wayne_sf, aes(fill = 'rosybrown1')) +
  geom_sf(data = Intersection, aes(color = 'blue'), size = 2, shape = 8) +
  scale_fill_identity(name = "", breaks = c("lavender", "lightblue1", "palegreen", "thistle1", "lightyellow1", "rosybrown1"),
                      labels = c('Robeson', 'Sampson', 'Duplin', 'Bladen', 'Greene', 'Wayne'),
                      guide = "legend") +
    scale_color_identity(name = "", breaks = c("blue"), labels = c("Hog Farm Locations"), guide = "legend") +
  ggtitle("NC counties with high populations of Hog Farms") +
  mytheme
print(HighPop)

```

\newpage

##Visualization Analysis
###Population
```{r ggplots population, include = FALSE, message = FALSE, error = FALSE}
nccounties.health <- read.csv("./Data/Processed/CountyHogs_HealthData.csv", stringsAsFactors = FALSE)

nccounties.health <- nccounties.health %>% filter(X != "NC")

#library(ggplot2)
#library(cowplot)

#POPULATION DISTRIBUTION
NC.pop.distribution <- ggplot(nccounties.health) +
  geom_col(aes(x = X, y = Population, fill = X)) +
  xlab("") +
  theme(axis.text.x = element_text(angle = 60, hjust = 1))

w.pop.distribution <- ggplot(nccounties.health) +
  geom_col(aes(x= X, y= White_Population_percentage, fill = X)) +
  xlab("") +
  ylab("White") +
  theme(axis.text.x = element_text(angle = 60, hjust = 1))

aa.pop.distribution <- ggplot(nccounties.health) +
  geom_col(aes(x= X, y= African_American_percentage, fill = X)) +
  xlab("") +
  ylab("African American")+
  theme(axis.text.x = element_text(angle = 60, hjust = 1))

h.pop.distribution <- ggplot(nccounties.health) +
  geom_col(aes(x= X, y= Hispanic_Latinx_percentage, fill = X)) +
  xlab("") +
  ylab("Hispanic/Latinx")+
  theme(axis.text.x = element_text(angle = 60, hjust = 1))

i.pop.distribution <- ggplot(nccounties.health) +
  geom_col(aes(x= X, y= American_Indian_percentage, fill = X)) +
  xlab("") +
  ylab("Indigenous/Native American")+
  theme(axis.text.x = element_text(angle = 60, hjust = 1))

counties.legend <- get_legend(NC.pop.distribution)

```

```{r pop final, echo = FALSE, message = FALSE, error = FALSE}
pop.plot <- plot_grid(NC.pop.distribution + theme(legend.position = "none"),
                      w.pop.distribution + theme(legend.position = "none"),
                      aa.pop.distribution + theme(legend.position = "none"),
                      h.pop.distribution + theme(legend.position = "none"),
                      i.pop.distribution + theme(legend.position = "none"),
                      nrow = 2,
                      align = 'hv')
pop.title <- ggdraw() +
  draw_label("Population Distribution by County(%)",
             fontface='bold',
             x = 0,
             hjust = 0) +
  theme(plot.margin = margin (0,0,0,7))

pop.plot.complete <- plot_grid(pop.title, pop.plot, 
                               ncol = 1, rel_heights = c(0.1, 1))

pop.plot.complete

```


###Chronic Illness
```{r ggplots disease, include = FALSE, message = FALSE, error = FALSE}
#Chronic Health
cancer.plot <- ggplot(nccounties.health) +
  geom_col(aes(x = X, y = Cancer_Incidence, fill = X)) +
  xlab("")+
  ylab("Cancer Incidence Rates per 100,000 pop.")+
  theme(axis.text.x = element_text(angle = 60, hjust = 1))

heart.plot <- ggplot(nccounties.health) +
  geom_col(aes(x=X, y= Heart_Disease, fill = X)) +
  xlab("") +
  ylab("Heart Disease Deaths per 100,000 pop.")+
  theme(axis.text.x = element_text(angle = 60, hjust = 1))
```

```{r disease final, echo = FALSE, message = FALSE, error = FALSE}
chronic.disease.plot <- plot_grid(cancer.plot + theme(legend.position = "none"),
                                  heart.plot + theme(legend.position = "none"),
                                  phys.plot + theme(legend.position = "none"),
                                  nrow = 1,
                                  align = 'hv')
disease.title <- ggdraw() +
  draw_label("Chronic Health Incidence Rates",
             fontface='bold',
             x = 0,
             hjust = 0) +
  theme(plot.margin = margin (0,0,0,7))

chronic.disease.complete <- plot_grid(disease.title, chronic.disease.plot,
                                      ncol = 1, rel_heights = c(0.1, 1))
chronic.disease.complete
```

###Health Challenge Indicators
```{r, health plot, include = FALSE, message = FALSE, error = FALSE}
phys.plot <- ggplot(nccounties.health) +
  geom_col(aes(x = X, y = Primary_Care_Physicians, fill = X)) +
  xlab("") +
  ylab("Physicians per 10,000 pop.")+
  theme(axis.text.x = element_text(angle = 60, hjust = 1))

pov.plot <- ggplot(nccounties.health) +
  geom_col(aes(x = X, y = Poverty_percentage, fill = X)) +
  xlab("") +
  ylab("% Individ. Living in Poverty") +
  theme(axis.text.x = element_text(angle = 60, hjust = 1))
  
air.plot <- ggplot(nccounties.health) +
  geom_col(aes(x = X, y = Air_Pollution, fill = X)) +
  xlab("") +
  ylab("Avg. Daily Density of PM (u/m3)") +
  theme(axis.text.x = element_text(angle = 60, hjust = 1))

uninsured.plot <- ggplot(nccounties.health) +
  geom_col(aes(x = X, y = Uninsured_Adults_percentage, fill = X)) +
  xlab("") +
  ylab("% Uninsured Adults") +
  theme(axis.text.x = element_text(angle = 60, hjust = 1))

medicaid.plot <- ggplot(nccounties.health) +
  geom_col(aes(x = X, y = Medicaid_CHIP_enrolles_percentage, fill = X)) +
  xlab("") +
  ylab("% Pop. Enrolled in Medicaid") +
  theme(axis.text.x = element_text(angle = 60, hjust = 1))

```

```{r, final health, echo = FALSE, message = FALSE, error = FALSE}
health.plot.1 <- plot_grid (phys.plot + theme(legend.position = "none"),
                          pov.plot + theme(legend.position = "none"),
                          air.plot + theme(legend.position = "none"),
                          ncol = 3,
                          align = 'hv')
health.plot.2 <- plot_grid( uninsured.plot + theme(legend.position = "none"),
                          medicaid.plot + theme(legend.position = "none"),
                          ncol = 2,
                          align = 'hv')

health.plot <- plot_grid(health.plot.1, health.plot.2,
                         nrow = 2,
                         align = 'hv')
health.title <- ggdraw() +
  draw_label("Health Risk Indicators",
             fontface='bold',
             x = 0,
             hjust = 0) +
  theme(plot.margin = margin (0,0,0,7))

health.plot.final <- plot_grid(health.title, health.plot,
                               ncol = 1, rel_heights = c(0.1, 1))
health.plot.final

```

###Infant Health
```{r infant plots, include = FALSE, message = FALSE, error = FALSE}
birthweight.plot <- ggplot(nccounties.health) +
  geom_col(aes(x = X, y = Low_Birthweight_percentage, fill = X)) +
  xlab("") +
  ylab("% newborns under 2.5kg")+
  theme(axis.text.x = element_text(angle = 60, hjust = 1))

mortality.plot <- ggplot(nccounties.health) +
  geom_col(aes(x= X, y = Infant_Mortality_Rate, fill = X)) +
  xlab("") +
  ylab("Infant Death Rates per 1,000 births")+
  theme(axis.text.x = element_text(angle = 60, hjust = 1))
```

```{r final infant, echo = FALSE, message = FALSE, error = FALSE}
infant.plot <- plot_grid(birthweight.plot + theme(legend.position = "none"),
                         mortality.plot + theme(legend.position = "none"),
                         ncol = 2,
                         align = 'hv')

infant.title <- ggdraw() +
  draw_label("Infant Health Disparities",
             fontface='bold',
             x = 0,
             hjust = 0) +
  theme(plot.margin = margin (0,0,0,7))

infant.plot.final <- plot_grid(infant.title, infant.plot,
                               ncol = 1, rel_heights = c(0.1, 1))
infant.plot.final

```



\newpage

#Analysis


## Question 1: 

## Question 2: 



\newpage

# Summary and Conclusions


\newpage

# References

+ [Environmental Working Group Map - Distribution of Animal Agriculture Farms] <https://www.ewg.org/interactive-maps/2020-fields-of-filth/map/>
+ [NC Farms and Floodplains] <https://sites.tufts.edu/gis/files/2017/06/Moore_Emily_UEP232_2016.pdf>
